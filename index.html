<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoGateDocs - Préparez votre voyage</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Loader animation */
        .loader { border-top-color: #3B82F6; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="root">
        <div class="fixed inset-0 flex items-center justify-center bg-slate-50 z-50">
            <div class="flex flex-col items-center gap-4">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                <p class="text-slate-500 font-sans text-sm font-medium">Chargement de GoGateDocs...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">

        // --- 1. RECUPERATION FIABLE DES ICONES ---
        // Cette version de Lucide expose "window.lucideReact"
        const icons = window.lucideReact;
        
        // Extraction manuelle pour éviter tout bug
        const Plane = icons.Plane;
        const MapPin = icons.MapPin;
        const Calendar = icons.Calendar;
        const ShieldCheck = icons.ShieldCheck;
        const Trophy = icons.Trophy;
        const ArrowRight = icons.ArrowRight;
        const Heart = icons.Heart;
        const Globe = icons.Globe;
        const ExternalLink = icons.ExternalLink;
        const CheckCircle = icons.CheckCircle;
        const AlertTriangle = icons.AlertTriangle;
        const Info = icons.Info;
        const Languages = icons.Languages;
        const Clock = icons.Clock;
        const Copyright = icons.Copyright;
        const Navigation = icons.Navigation;
        const LinkIcon = icons.Link;
        const Stethoscope = icons.Stethoscope;
        const Droplets = icons.Droplets;
        const Siren = icons.Siren;
        const Wifi = icons.Wifi;
        const Ticket = icons.Ticket;
        const Timer = icons.Timer;
        const MessageSquare = icons.MessageSquare;
        const Umbrella = icons.Umbrella;
        const Calculator = icons.Calculator;
        const Mail = icons.Mail;
        const Menu = icons.Menu;
        const X = icons.X;

        // --- 2. CONFIGURATION ---
        const AFFILIATE_CONFIG = {
            flight_marker: "YOUR_ID", 
            hotel_aid: "YOUR_ID",
            esim_id: "YOUR_ID", 
            activities_id: "YOUR_ID",
            insurance_link: "YOUR_INSURANCE_LINK"
        };

        const { useState, useEffect } = React;

        // --- 3. TRADUCTIONS ---
        const translations = {
            FR: {
                subtitle: "V2.0 Mondiale",
                app_name: "GoGateDocs",
                menu_home: "Accueil",
                menu_budget: "Budget",
                menu_insurance: "Assurance",
                menu_feedback: "Aide & Avis",
                label_nationality: "Votre Nationalité (Passeport)",
                label_origin: "Pays de départ (Pour le vol)",
                label_destination: "Destination",
                label_age: "Âge du voyageur",
                label_start_date: "Date de départ",
                label_end_date: "Date de retour",
                placeholder_select: "Sélectionner un pays...",
                btn_analyze: "Lancer l'analyse",
                loading_title: "Analyse de votre itinéraire",
                loading_text: "Vérification des formalités...",
                result_back: "Modifier",
                passport_power: "Puissance du Passeport",
                access_text: "Accès simplifié à",
                countries_text: "pays",
                docs_title: "Documents & Liens Officiels",
                health_title: "Santé & Hygiène",
                customs_title: "Douanes & Interdits (Attention !)",
                docs_disclaimer: "Les liens redirigent vers les sites gouvernementaux officiels.",
                action_title: "Réserver au meilleur prix",
                action_flight: "Vols : Accéder aux tarifs secrets (-30%)",
                action_hotel: "Hôtels : Voir les offres exclusives (-40%)",
                offer_expires: "Ces offres tarifaires expirent dans",
                services_title: "Indispensables pour ce voyage",
                service_esim: "Internet sur place (eSIM)",
                service_esim_desc: "Restez connecté sans frais d'itinérance.",
                service_activities: "Activités & Visites",
                service_activities_desc: "Billets coupe-file et excursions.",
                donate_title: "Soutenez ce projet gratuit",
                donate_text: "GoGateDocs est 100% gratuit. Si nous vous avons aidé, offrez-nous un café !",
                donate_btn: "Faire un don",
                hero_title: "Préparez votre départ",
                hero_highlight: "simplement",
                hero_desc: "Visas, vaccins, interdits douaniers... on vous dit tout.",
                doc_mandatory: "Obligatoire",
                cost: "Coût",
                footer_rights: "Tous droits réservés. Reproduction interdite.",
                footer_affiliate: "Transparence : Ce site contient des liens affiliés.",
                duration_calc: "Durée du séjour :",
                origin_same_dest_error: "Le pays de départ et la destination ne peuvent pas être identiques.",
                missing_dest_error: "Veuillez sélectionner une destination.",
                btn_official_link: "Accéder au site officiel",
                water_safe: "Eau du robinet potable",
                water_unsafe: "Eau du robinet NON potable",
                vaccine_mandatory: "Vaccin Obligatoire :",
                forbidden_items: "Strictement Interdit :",
                budget_title: "Estimateur de Budget Voyage",
                budget_desc: "Estimez le coût de votre séjour (hors vols) selon votre style.",
                budget_style_low: "Backpacker (Eco)",
                budget_style_med: "Confort (Standard)",
                budget_style_high: "Luxe",
                budget_result: "Budget estimé sur place :",
                insurance_title: "Assurance Voyage",
                insurance_subtitle: "Ne partez jamais sans couverture",
                insurance_desc: "Les frais médicaux à l'étranger peuvent coûter une fortune. Protégez-vous pour quelques euros par jour.",
                btn_get_quote: "Obtenir un devis gratuit",
                feedback_title: "Besoin d'aide ?",
                feedback_desc: "Une erreur sur le site ? Une suggestion ? Contactez l'équipe GoGateDocs.",
                feedback_placeholder: "Votre message...",
                btn_send: "Envoyer",
                days: "jours"
            },
            EN: {
                subtitle: "V2.0 Global",
                app_name: "GoGateDocs",
                menu_home: "Home",
                menu_budget: "Budget",
                menu_insurance: "Insurance",
                menu_feedback: "Help & Feedback",
                label_nationality: "Your Nationality (Passport)",
                label_origin: "Departure Country (For flights)",
                label_destination: "Destination",
                label_age: "Traveler Age",
                label_start_date: "Departure Date",
                label_end_date: "Return Date",
                placeholder_select: "Select a country...",
                btn_analyze: "Start Analysis",
                loading_title: "Analyzing Itinerary",
                loading_text: "Checking formalities...",
                result_back: "Edit",
                passport_power: "Passport Power",
                access_text: "Easy access to",
                countries_text: "countries",
                docs_title: "Documents & Official Links",
                health_title: "Health & Hygiene",
                customs_title: "Customs & Forbidden Items",
                docs_disclaimer: "Links redirect to official government websites.",
                action_title: "Book at the best price",
                action_flight: "Flights: Unlock secret fares (-30%)",
                action_hotel: "Hotels: See exclusive deals (-40%)",
                offer_expires: "These offers expire in",
                services_title: "Essentials for this trip",
                service_esim: "Mobile Data (eSIM)",
                service_esim_desc: "Stay connected without roaming fees.",
                service_activities: "Tours & Activities",
                service_activities_desc: "Skip-the-line tickets & tours.",
                donate_title: "Support this free project",
                donate_text: "GoGateDocs is 100% free. If we helped you, buy us a coffee!",
                donate_btn: "Donate",
                hero_title: "Prepare your trip",
                hero_highlight: "simply",
                hero_desc: "Visas, vaccines, customs bans... we tell you everything.",
                doc_mandatory: "Mandatory",
                cost: "Cost",
                footer_rights: "All rights reserved. Reproduction prohibited.",
                footer_affiliate: "Transparency: This site contains affiliate links.",
                duration_calc: "Trip duration:",
                origin_same_dest_error: "Origin and destination cannot be the same.",
                missing_dest_error: "Please select a destination.",
                btn_official_link: "Access official site",
                water_safe: "Tap water is drinkable",
                water_unsafe: "Tap water is NOT drinkable",
                vaccine_mandatory: "Mandatory Vaccine:",
                forbidden_items: "Strictly Forbidden:",
                budget_title: "Travel Budget Estimator",
                budget_desc: "Estimate your daily costs (excluding flights) based on your style.",
                budget_style_low: "Backpacker (Eco)",
                budget_style_med: "Comfort (Standard)",
                budget_style_high: "Luxury",
                budget_result: "Estimated local budget:",
                insurance_title: "Travel Insurance",
                insurance_subtitle: "Never travel uncovered",
                insurance_desc: "Medical costs abroad can be astronomical. Protect yourself for a few dollars a day.",
                btn_get_quote: "Get a Free Quote",
                feedback_title: "Need Help?",
                feedback_desc: "Found an error? Have a suggestion? Contact the GoGateDocs team.",
                feedback_placeholder: "Your message...",
                btn_send: "Send",
                days: "days"
            }
        };

        // --- 4. BASE DE DONNÉES PAYS ---
        const countries = [
            // --- EUROPE ---
            { code: "FR", name: "France", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 1.8 },
            { code: "DE", name: "Allemagne", region: "EU", continent: "Europe", power: 129, water: "safe", costFactor: 1.7 },
            { code: "IT", name: "Italie", region: "EU", continent: "Europe", power: 129, water: "safe", costFactor: 1.6 },
            { code: "ES", name: "Espagne", region: "EU", continent: "Europe", power: 129, water: "safe", costFactor: 1.5 },
            { code: "GB", name: "Royaume-Uni", region: "EU_NON_SCHENGEN", continent: "Europe", power: 125, water: "safe", costFactor: 2.0 },
            { code: "BE", name: "Belgique", region: "EU", continent: "Europe", power: 127, water: "safe", costFactor: 1.8 },
            { code: "CH", name: "Suisse", region: "EU", continent: "Europe", power: 126, water: "safe", costFactor: 2.5 },
            { code: "PT", name: "Portugal", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 1.4 },
            { code: "NL", name: "Pays-Bas", region: "EU", continent: "Europe", power: 127, water: "safe", costFactor: 1.9 },
            { code: "AT", name: "Autriche", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 1.7 },
            { code: "SE", name: "Suède", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 1.9 },
            { code: "NO", name: "Norvège", region: "EU", continent: "Europe", power: 126, water: "safe", costFactor: 2.3 },
            { code: "DK", name: "Danemark", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 2.1 },
            { code: "FI", name: "Finlande", region: "EU", continent: "Europe", power: 128, water: "safe", costFactor: 2.0 },
            { code: "GR", name: "Grèce", region: "EU", continent: "Europe", power: 125, water: "safe", costFactor: 1.4 },
            { code: "IE", name: "Irlande", region: "EU_NON_SCHENGEN", continent: "Europe", power: 126, water: "safe", costFactor: 1.9 },
            { code: "PL", name: "Pologne", region: "EU", continent: "Europe", power: 124, water: "safe", costFactor: 0.9 },
            { code: "CZ", name: "République Tchèque", region: "EU", continent: "Europe", power: 124, water: "safe", costFactor: 1.0 },
            { code: "HU", name: "Hongrie", region: "EU", continent: "Europe", power: 122, water: "safe", costFactor: 0.9 },
            { code: "IS", name: "Islande", region: "EU_NON_SCHENGEN", continent: "Europe", power: 120, water: "safe", costFactor: 2.4 },
            { code: "HR", name: "Croatie", region: "EU", continent: "Europe", power: 123, water: "safe", costFactor: 1.2 },
            { code: "MT", name: "Malte", region: "EU", continent: "Europe", power: 122, water: "safe", costFactor: 1.5 },
            { code: "CY", name: "Chypre", region: "EU", continent: "Europe", power: 123, water: "safe", costFactor: 1.4 },
            { code: "LU", name: "Luxembourg", region: "EU", continent: "Europe", power: 127, water: "safe", costFactor: 2.0 },
            { code: "SI", name: "Slovénie", region: "EU", continent: "Europe", power: 125, water: "safe", costFactor: 1.3 },
            { code: "SK", name: "Slovaquie", region: "EU", continent: "Europe", power: 124, water: "safe", costFactor: 1.0 },
            { code: "EE", name: "Estonie", region: "EU", continent: "Europe", power: 126, water: "safe", costFactor: 1.1 },
            { code: "LV", name: "Lettonie", region: "EU", continent: "Europe", power: 125, water: "safe", costFactor: 1.0 },
            { code: "LT", name: "Lituanie", region: "EU", continent: "Europe", power: 125, water: "safe", costFactor: 1.0 },
            { code: "BG", name: "Bulgarie", region: "EU", continent: "Europe", power: 120, water: "safe", costFactor: 0.8 },
            { code: "RO", name: "Roumanie", region: "EU", continent: "Europe", power: 121, water: "safe", costFactor: 0.8 },
            { code: "MC", name: "Monaco", region: "EU_NON_SCHENGEN", continent: "Europe", power: 110, water: "safe", costFactor: 3.0 },
            { code: "AD", name: "Andorre", region: "EU_NON_SCHENGEN", continent: "Europe", power: 110, water: "safe", costFactor: 1.5 },
            { code: "AL", name: "Albanie", region: "EU_EAST", continent: "Europe", power: 95, water: "unsafe", costFactor: 0.7 },
            { code: "ME", name: "Monténégro", region: "EU_EAST", continent: "Europe", power: 100, water: "unsafe", costFactor: 0.9 },
            { code: "RS", name: "Serbie", region: "EU_EAST", continent: "Europe", power: 105, water: "unsafe", costFactor: 0.8 },
            { code: "BA_BOS", name: "Bosnie-Herzégovine", region: "EU_EAST", continent: "Europe", power: 95, water: "unsafe", costFactor: 0.7 },
            { code: "MK", name: "Macédoine du Nord", region: "EU_EAST", continent: "Europe", power: 98, water: "safe", costFactor: 0.7 },
            { code: "RU", name: "Russie", region: "EU_EAST", continent: "Europe", power: 90, water: "unsafe", costFactor: 1.1, customs: ["Médicaments codéinés", "Drones (Réglementé)"] },
            { code: "UA", name: "Ukraine", region: "EU_EAST", continent: "Europe", power: 95, water: "unsafe", costFactor: 0.6 },
            { code: "BY", name: "Biélorussie", region: "EU_EAST", continent: "Europe", power: 80, water: "unsafe", costFactor: 0.7 },
            { code: "TR", name: "Turquie", region: "EU_EAST", continent: "Europe", power: 85, water: "unsafe", costFactor: 0.8, customs: ["Antiquités (Interdiction stricte de sortie)"] },

            // --- AMÉRIQUES ---
            { code: "US", name: "États-Unis", region: "NA", continent: "Amériques", power: 116, water: "safe", costFactor: 2.2, customs: ["Kinder Surprise", "Fruits/Viandes", "Fromages non pasteurisés"] },
            { code: "CA", name: "Canada", region: "NA", continent: "Amériques", power: 115, water: "safe", costFactor: 2.0, customs: ["Cannabis (Déclaration obligatoire frontières)"] },
            { code: "MX", name: "Mexique", region: "NA", continent: "Amériques", power: 90, water: "unsafe", costFactor: 1.0, customs: ["Plus de 10 paquets de cigarettes"] },
            { code: "CQ", name: "Cancún / Quintana Roo (Mexique)", region: "NA", continent: "Amériques", power: 90, water: "unsafe", costFactor: 1.4, customs: ["Cigarettes électroniques (Réglementé)"] },
            { code: "BR", name: "Brésil", region: "SA", continent: "Amériques", power: 100, water: "unsafe", costFactor: 1.1, health: { yellowFever: true }, customs: ["Espèces protégées"] },
            { code: "AR", name: "Argentine", region: "SA", continent: "Amériques", power: 98, water: "unsafe", costFactor: 0.8 },
            { code: "CO", name: "Colombie", region: "SA", continent: "Amériques", power: 80, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "PE", name: "Pérou", region: "SA", continent: "Amériques", power: 85, water: "unsafe", costFactor: 0.9, customs: ["Feuilles de Coca (Quantité limitée)"] },
            { code: "CL", name: "Chili", region: "SA", continent: "Amériques", power: 118, water: "safe", costFactor: 1.3 },
            { code: "CR", name: "Costa Rica", region: "SA", continent: "Amériques", power: 95, water: "safe", costFactor: 1.4 },
            { code: "PA", name: "Panama", region: "SA", continent: "Amériques", power: 94, water: "safe", costFactor: 1.2 },
            { code: "UY", name: "Uruguay", region: "SA", continent: "Amériques", power: 96, water: "safe", costFactor: 1.3 },
            { code: "PY", name: "Paraguay", region: "SA", continent: "Amériques", power: 85, water: "unsafe", costFactor: 0.7 },
            { code: "BO", name: "Bolivie", region: "SA", continent: "Amériques", power: 82, water: "unsafe", costFactor: 0.6, health: { yellowFever: true } },
            { code: "EC", name: "Équateur", region: "SA", continent: "Amériques", power: 86, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "VE", name: "Venezuela", region: "SA", continent: "Amériques", power: 70, water: "unsafe", costFactor: 0.7, health: { yellowFever: true } },
            { code: "GT", name: "Guatemala", region: "SA", continent: "Amériques", power: 88, water: "unsafe", costFactor: 0.8 },
            { code: "DO", name: "République Dominicaine", region: "NA", continent: "Amériques", power: 65, water: "unsafe", costFactor: 1.1 },
            { code: "CU", name: "Cuba", region: "NA", continent: "Amériques", power: 55, water: "unsafe", costFactor: 0.9, customs: ["Drones", "GPS Satellite"] },
            { code: "JM", name: "Jamaïque", region: "NA", continent: "Amériques", power: 75, water: "unsafe", costFactor: 1.5 },
            { code: "BS", name: "Bahamas", region: "NA", continent: "Amériques", power: 85, water: "unsafe", costFactor: 2.5 },
            { code: "BB", name: "Barbade", region: "NA", continent: "Amériques", power: 90, water: "safe", costFactor: 2.2 },

            // --- ASIE ---
            { code: "JP", name: "Japon", region: "AS", continent: "Asie", power: 130, water: "safe", costFactor: 1.6, customs: ["Médicaments (Vicks inhaler, codéine)", "Couteaux de poche"] },
            { code: "KR", name: "Corée du Sud", region: "AS", continent: "Asie", power: 129, water: "safe", costFactor: 1.4 },
            { code: "SG", name: "Singapour", region: "AS", continent: "Asie", power: 130, water: "safe", costFactor: 2.2, customs: ["Chewing-gum (Interdit vente)", "Cigarette électronique"] },
            { code: "CN", name: "Chine", region: "AS", continent: "Asie", power: 80, water: "unsafe", costFactor: 1.1, customs: ["VPN", "Littérature politique"] },
            { code: "HK", name: "Hong Kong", region: "AS", continent: "Asie", power: 115, water: "safe", costFactor: 1.9 },
            { code: "TW", name: "Taïwan", region: "AS", continent: "Asie", power: 105, water: "safe", costFactor: 1.2 },
            { code: "TH", name: "Thaïlande", region: "AS", continent: "Asie", power: 70, water: "unsafe", costFactor: 0.8, customs: ["Cigarette électronique (Prison possible !)", "Plus de 200 cigarettes"] },
            { code: "VN", name: "Vietnam", region: "AS", continent: "Asie", power: 65, water: "unsafe", costFactor: 0.6, customs: ["Drones (Déclaration obligatoire)"] },
            { code: "ID", name: "Indonésie", region: "AS", continent: "Asie", power: 68, water: "unsafe", costFactor: 0.7, customs: ["Drogues (Peine de mort)"] },
            { code: "BA", name: "Bali (Indonésie)", region: "AS", continent: "Asie", power: 68, water: "unsafe", costFactor: 1.0, customs: ["Drogues (Tolérance Zéro)"] },
            { code: "MY", name: "Malaisie", region: "AS", continent: "Asie", power: 110, water: "unsafe", costFactor: 0.8, customs: ["Drogues (Peine très lourde)"] },
            { code: "PH", name: "Philippines", region: "AS", continent: "Asie", power: 66, water: "unsafe", costFactor: 0.7 },
            { code: "KH", name: "Cambodge", region: "AS", continent: "Asie", power: 50, water: "unsafe", costFactor: 0.6 },
            { code: "LA", name: "Laos", region: "AS", continent: "Asie", power: 45, water: "unsafe", costFactor: 0.5 },
            { code: "LK", name: "Sri Lanka", region: "AS", continent: "Asie", power: 42, water: "unsafe", costFactor: 0.6 },
            { code: "MV", name: "Maldives", region: "AS", continent: "Asie", power: 60, water: "unsafe", costFactor: 2.5, customs: ["Alcool (Strictement interdit)", "Porc", "Idoles religieuses"] },
            { code: "IN", name: "Inde", region: "AS", continent: "Asie", power: 60, water: "unsafe", costFactor: 0.5 },
            { code: "NP", name: "Népal", region: "AS", continent: "Asie", power: 55, water: "unsafe", costFactor: 0.5 },
            { code: "MN", name: "Mongolie", region: "AS", continent: "Asie", power: 60, water: "unsafe", costFactor: 0.8 },
            { code: "KZ", name: "Kazakhstan", region: "AS", continent: "Asie", power: 70, water: "unsafe", costFactor: 0.7 },
            { code: "UZ", name: "Ouzbékistan", region: "AS", continent: "Asie", power: 65, water: "unsafe", costFactor: 0.6, customs: ["Médicaments psychotropes (Très strict)"] },
            { code: "PK", name: "Pakistan", region: "AS", continent: "Asie", power: 45, water: "unsafe", costFactor: 0.5, customs: ["Alcool"] },
            { code: "BD", name: "Bangladesh", region: "AS", continent: "Asie", power: 50, water: "unsafe", costFactor: 0.5 },

            // --- MOYEN-ORIENT ---
            { code: "AE", name: "Émirats Arabes Unis (Dubaï)", region: "ME", continent: "Afrique / M-O", power: 110, water: "safe", costFactor: 2.0, customs: ["Médicaments (Codéine)", "Graines de pavot"] },
            { code: "QA", name: "Qatar", region: "ME", continent: "Afrique / M-O", power: 100, water: "safe", costFactor: 2.1, customs: ["Alcool", "Porc", "Vape"] },
            { code: "SA", name: "Arabie Saoudite", region: "ME", continent: "Afrique / M-O", power: 85, water: "unsafe", costFactor: 1.8, customs: ["Alcool (Tolérance Zéro)", "Symboles religieux", "Porc"] },
            { code: "IL", name: "Israël", region: "ME", continent: "Afrique / M-O", power: 105, water: "safe", costFactor: 1.9 },
            { code: "JO", name: "Jordanie", region: "ME", continent: "Afrique / M-O", power: 75, water: "unsafe", costFactor: 1.3, customs: ["Drones (Interdit)"] },
            { code: "OM", name: "Oman", region: "ME", continent: "Afrique / M-O", power: 88, water: "unsafe", costFactor: 1.5 },
            { code: "KW", name: "Koweït", region: "ME", continent: "Afrique / M-O", power: 95, water: "safe", costFactor: 2.0 },
            { code: "BH", name: "Bahreïn", region: "ME", continent: "Afrique / M-O", power: 92, water: "safe", costFactor: 1.8 },
            { code: "LB", name: "Liban", region: "ME", continent: "Afrique / M-O", power: 60, water: "unsafe", costFactor: 1.2 },

            // --- AFRIQUE ---
            { code: "MA", name: "Maroc", region: "AF", continent: "Afrique / M-O", power: 65, water: "unsafe", costFactor: 0.7, customs: ["Drones (Confiscation immédiate)"] },
            { code: "ZA", name: "Afrique du Sud", region: "AF", continent: "Afrique / M-O", power: 95, water: "unsafe", costFactor: 1.0 },
            { code: "EG", name: "Égypte", region: "AF", continent: "Afrique / M-O", power: 50, water: "unsafe", costFactor: 0.6, customs: ["Drones (Interdit - Prison)"] },
            { code: "TN", name: "Tunisie", region: "AF", continent: "Afrique / M-O", power: 60, water: "unsafe", costFactor: 0.6, customs: ["Dinars (Interdit d'exporter)"] },
            { code: "ZN", name: "Zanzibar (Tanzanie)", region: "AF", continent: "Afrique / M-O", power: 52, water: "unsafe", costFactor: 1.2, health: { yellowFever: true }, customs: ["Sacs plastiques (Interdit)", "Coquillages"] },
            { code: "KE", name: "Kenya", region: "AF", continent: "Afrique / M-O", power: 55, water: "unsafe", costFactor: 1.1, health: { yellowFever: true }, customs: ["Sacs plastiques", "Drones"] },
            { code: "TZ", name: "Tanzanie", region: "AF", continent: "Afrique / M-O", power: 52, water: "unsafe", costFactor: 1.1, health: { yellowFever: true }, customs: ["Sacs plastiques"] },
            { code: "SN", name: "Sénégal", region: "AF", continent: "Afrique / M-O", power: 58, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "CI", name: "Côte d'Ivoire", region: "AF", continent: "Afrique / M-O", power: 56, water: "unsafe", costFactor: 0.9, health: { yellowFever: true } },
            { code: "CM", name: "Cameroun", region: "AF", continent: "Afrique / M-O", power: 50, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "DZ", name: "Algérie", region: "AF", continent: "Afrique / M-O", power: 55, water: "unsafe", costFactor: 0.7, customs: ["Jumelles (Souvent confisquées)"] },
            { code: "MU", name: "Île Maurice", region: "AF", continent: "Afrique / M-O", power: 90, water: "unsafe", costFactor: 1.4, customs: ["Papier à cigarette", "Spearguns"] },
            { code: "NA", name: "Namibie", region: "AF", continent: "Afrique / M-O", power: 80, water: "safe", costFactor: 1.3 },
            { code: "MG", name: "Madagascar", region: "AF", continent: "Afrique / M-O", power: 50, water: "unsafe", costFactor: 0.6 },
            { code: "SC", name: "Seychelles", region: "AF", continent: "Afrique / M-O", power: 85, water: "safe", costFactor: 2.5 },
            { code: "ET", name: "Éthiopie", region: "AF", continent: "Afrique / M-O", power: 50, water: "unsafe", costFactor: 0.7, health: { yellowFever: true } },
            { code: "RW", name: "Rwanda", region: "AF", continent: "Afrique / M-O", power: 60, water: "unsafe", costFactor: 1.0, health: { yellowFever: true }, customs: ["Sacs plastiques (Interdit)"] },
            { code: "UG", name: "Ouganda", region: "AF", continent: "Afrique / M-O", power: 55, water: "unsafe", costFactor: 0.9, health: { yellowFever: true } },
            { code: "NG", name: "Nigéria", region: "AF", continent: "Afrique / M-O", power: 45, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "GH", name: "Ghana", region: "AF", continent: "Afrique / M-O", power: 58, water: "unsafe", costFactor: 0.8, health: { yellowFever: true } },
            { code: "BW", name: "Botswana", region: "AF", continent: "Afrique / M-O", power: 75, water: "safe", costFactor: 1.4 },

            // --- OCÉANIE ---
            { code: "AU", name: "Australie", region: "OC", continent: "Océanie", power: 120, water: "safe", costFactor: 2.1, customs: ["Nourriture (Bio-sécurité extrême)", "Terres/Sables"] },
            { code: "NZ", name: "Nouvelle-Zélande", region: "OC", continent: "Océanie", power: 119, water: "safe", costFactor: 2.0, customs: ["Matériel de randonnée sale", "Nourriture"] },
            { code: "FJ", name: "Fidji", region: "OC", continent: "Océanie", power: 80, water: "unsafe", costFactor: 1.4 },
            { code: "PF", name: "Polynésie Française", region: "OC", continent: "Océanie", power: 128, water: "safe", costFactor: 2.5 },
            { code: "NC", name: "Nouvelle-Calédonie", region: "OC", continent: "Océanie", power: 128, water: "safe", costFactor: 2.2 },
        ].sort((a, b) => a.name.localeCompare(b.name));

        // --- FONCTIONS UTILITAIRES ---
        const groupCountriesByContinent = (list) => {
            return list.reduce((groups, country) => {
                const continent = country.continent;
                if (!groups[continent]) groups[continent] = [];
                groups[continent].push(country);
                return groups;
            }, {});
        };

        const generateFlightLink = (origin, dest, startDate, endDate) => {
            const formatDates = (d) => d.slice(2,4) + d.slice(5,7) + d.slice(8,10);
            const startStr = formatDates(startDate);
            const endStr = formatDates(endDate);
            let destCode = dest.toLowerCase();
            if (destCode === 'ba') destCode = 'dps'; 
            if (destCode === 'zn') destCode = 'znz';
            if (destCode === 'cq') destCode = 'cun';
            if (destCode === 'ae') destCode = 'dxb';
            
            return `https://www.skyscanner.fr/transport/vols/${origin.toLowerCase()}/${destCode}/${startStr}/${endStr}?associateid=${AFFILIATE_CONFIG.flight_marker}`;
        };

        // --- CORRECTION DATES BOOKING.COM ---
        const generateHotelLink = (destName, start, end) => {
            // start et end sont au format YYYY-MM-DD
            const [sYear, sMonth, sDay] = start.split('-');
            const [eYear, eMonth, eDay] = end.split('-');

            // Paramètres explicites Booking.com
            return `https://www.booking.com/searchresults.html?ss=${destName}&checkin_year=${sYear}&checkin_month=${sMonth}&checkin_monthday=${sDay}&checkout_year=${eYear}&checkout_month=${eMonth}&checkout_monthday=${eDay}&aid=${AFFILIATE_CONFIG.hotel_aid}`;
        };

        // --- COMPOSANTS UI ---

        const Header = ({ lang, setLang, t, setView }) => (
            <header className="w-full p-6 flex justify-between items-center max-w-4xl mx-auto border-b border-slate-100 bg-white/80 backdrop-blur-sm sticky top-0 z-50">
                <div 
                    className="flex items-center gap-2 text-slate-800 font-bold text-xl cursor-pointer"
                    onClick={() => setView('home')}
                >
                    <div className="bg-gradient-to-br from-blue-600 to-indigo-600 text-white p-2.5 rounded-xl shadow-blue-200 shadow-lg transform -rotate-6">
                        <Plane size={22} className="transform rotate-12" />
                    </div>
                    <span className="tracking-tight hidden sm:inline font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-slate-800 to-slate-600">
                        {t.app_name}.
                    </span>
                </div>
                
                <div className="flex items-center gap-3">
                    <div className="relative group">
                        <button className="flex items-center gap-2 text-sm font-sans font-medium text-slate-600 bg-slate-50 px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                            <Languages size={16} />
                            {lang}
                        </button>
                        <div className="absolute right-0 mt-2 w-32 bg-white rounded-xl shadow-xl border border-slate-100 p-1 hidden group-hover:block fade-in">
                            {Object.keys(translations).map((l) => (
                                <button
                                    key={l}
                                    onClick={() => setLang(l)}
                                    className={`w-full text-left px-3 py-2 rounded-lg text-sm font-sans ${lang === l ? 'bg-blue-50 text-blue-600 font-bold' : 'text-slate-600 hover:bg-slate-50'}`}
                                >
                                    {l === 'FR' ? 'Français' : 'English'}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-2 rounded-full border border-blue-100 hidden sm:block">
                        {t.subtitle}
                    </div>
                </div>
            </header>
        );

        const DesktopNav = ({ t, currentView, setView }) => {
            const navItems = [
                { id: 'home', icon: MapPin, label: t.menu_home },
                { id: 'budget', icon: Calculator, label: t.menu_budget },
                { id: 'insurance', icon: Umbrella, label: t.menu_insurance },
                { id: 'feedback', icon: MessageSquare, label: t.menu_feedback },
            ];

            return (
                <div className="hidden sm:flex justify-center gap-4 mb-8">
                {navItems.map((item) => (
                    <button
                        key={item.id}
                        onClick={() => setView(item.id)}
                        className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all ${currentView === item.id ? 'bg-blue-600 text-white shadow-lg shadow-blue-200' : 'bg-white text-slate-500 hover:bg-slate-50'}`}
                    >
                        <item.icon size={16} />
                        {item.label}
                    </button>
                ))}
                </div>
            );
        };

        const MobileNav = ({ t, currentView, setView }) => {
            const navItems = [
                { id: 'home', icon: MapPin, label: t.menu_home },
                { id: 'budget', icon: Calculator, label: t.menu_budget },
                { id: 'insurance', icon: Umbrella, label: t.menu_insurance },
                { id: 'feedback', icon: MessageSquare, label: t.menu_feedback },
            ];
            return (
                <div className="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 p-3 sm:hidden z-50 flex justify-around items-center pb-6">
                {navItems.map((item) => (
                    <button
                        key={item.id}
                        onClick={() => setView(item.id)}
                        className={`flex flex-col items-center gap-1 text-[10px] font-bold uppercase tracking-wide transition-colors ${currentView === item.id ? 'text-blue-600' : 'text-slate-400'}`}
                    >
                        <item.icon size={24} className={currentView === item.id ? 'stroke-2' : 'stroke-1'} />
                        {item.label}
                    </button>
                ))}
                </div>
            );
        };

        const InputField = ({ label, icon: Icon, children }) => (
            <div className="mb-5">
                <label className="text-slate-500 text-[10px] sm:text-xs uppercase tracking-wider font-bold mb-2 flex items-center gap-2">
                    <Icon size={14} className="text-blue-500" /> {label}
                </label>
                {children}
            </div>
        );

        const CountrySelect = ({ value, onChange, placeholder, excludeCode }) => {
            const grouped = groupCountriesByContinent(countries);
            const continentOrder = ["Europe", "Asie", "Amériques", "Afrique / M-O", "Océanie"];

            return (
                <select 
                    className="w-full bg-slate-50 border border-slate-200 text-slate-700 font-sans font-medium rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none cursor-pointer hover:bg-slate-100"
                    value={value}
                    onChange={onChange}
                >
                    <option value="">{placeholder}</option>
                    {continentOrder.map(continent => (
                        grouped[continent] && (
                        <optgroup key={continent} label={continent}>
                            {grouped[continent]
                            .filter(c => c.code !== excludeCode)
                            .map(c => (
                                <option key={c.code} value={c.code} className="font-sans">{c.name}</option>
                            ))
                            }
                        </optgroup>
                        )
                    ))}
                </select>
            );
        };

        const DocumentCard = ({ title, status, description, cost, isMandatory, link, t }) => {
            const getStatusColor = () => {
                switch(status) {
                    case 'ok': return 'bg-emerald-50 text-emerald-600 border-emerald-100';
                    case 'alert': return 'bg-amber-50 text-amber-600 border-amber-100';
                    case 'error': return 'bg-red-50 text-red-600 border-red-100';
                    default: return 'bg-blue-50 text-blue-600 border-blue-100';
                }
            };
            const getIcon = () => {
                switch(status) {
                    case 'ok': return <CheckCircle size={20} />;
                    case 'alert': return <AlertTriangle size={20} />;
                    case 'error': return <ShieldCheck size={20} />;
                    default: return <Info size={20} />;
                }
            };
            return (
                <div className="bg-white border border-slate-100 rounded-xl p-5 mb-3 shadow-sm hover:shadow-md transition-all duration-300 flex flex-row items-start gap-4 group">
                    <div className={`p-3 rounded-xl shrink-0 border ${getStatusColor()} transition-colors`}>{getIcon()}</div>
                    <div className="flex-1 w-full">
                        <div className="flex justify-between items-start">
                            <h4 className="font-bold text-slate-800 text-lg group-hover:text-blue-600 transition-colors">{title}</h4>
                            {isMandatory && <span className="bg-rose-50 text-rose-600 border border-rose-100 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider">{t.doc_mandatory}</span>}
                        </div>
                        <p className="text-sm text-slate-500 mt-1 leading-relaxed">{description}</p>
                        <div className="flex flex-wrap items-center gap-3 mt-3">
                            {cost && <div className="inline-flex items-center text-xs font-bold text-slate-700 bg-slate-50 px-2.5 py-1 rounded-md border border-slate-200">{t.cost}: {cost}</div>}
                            {link && <a href={link} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-1.5 text-xs font-bold text-white bg-blue-600 hover:bg-blue-700 px-3 py-1.5 rounded-md transition-colors shadow-sm">{t.btn_official_link}<ExternalLink size={12} /></a>}
                        </div>
                    </div>
                </div>
            );
        };

        const OfferCountdown = ({ t }) => {
            const [timeLeft, setTimeLeft] = useState(600);
            useEffect(() => {
                const timer = setInterval(() => setTimeLeft((prev) => (prev > 0 ? prev - 1 : 0)), 1000);
                return () => clearInterval(timer);
            }, []);
            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
            };
            return <div className="flex items-center justify-center gap-2 mb-4 text-sm font-medium text-rose-600 animate-pulse"><Clock size={16} /><span>{t.offer_expires} {formatTime(timeLeft)}</span></div>;
        };

        const PassportPower = ({ score, maxScore = 150, t }) => {
            const percentage = Math.min((score / maxScore) * 100, 100);
            let tier = "Bronze";
            let colorClass = "bg-amber-600";
            let trophyColor = "text-slate-300";
            if (score > 100) { tier = "Silver"; colorClass = "bg-slate-400"; trophyColor = "text-slate-300"; }
            if (score > 125) { tier = "Gold"; colorClass = "bg-yellow-500"; trophyColor = "text-yellow-400"; }
            return (
                <div className="bg-slate-900 text-white rounded-2xl p-6 mb-6 relative overflow-hidden shadow-xl transform transition-all hover:scale-[1.01]">
                    <div className="absolute top-0 right-0 p-4 opacity-10"><Globe size={120} /></div>
                    <div className="relative z-10">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h3 className="text-slate-400 text-xs uppercase font-bold tracking-widest">{t.passport_power}</h3>
                                <div className="text-4xl font-extrabold flex items-center gap-3 mt-2">
                                <Trophy size={32} className={trophyColor} />
                                {score} <span className="text-lg text-slate-500 font-normal">/ {maxScore}</span>
                                </div>
                            </div>
                            <div className={`px-4 py-1.5 rounded-full text-xs font-black text-slate-900 uppercase tracking-wide shadow-lg ${colorClass}`}>{tier} Tier</div>
                        </div>
                        <div className="w-full bg-slate-800 h-3 rounded-full overflow-hidden border border-slate-700">
                            <div className={`h-full ${colorClass} transition-all duration-1000 ease-out`} style={{ width: `${percentage}%` }}></div>
                        </div>
                        <p className="text-xs text-slate-400 mt-4 flex items-center gap-2"><CheckCircle size={12} className="text-green-500" />{t.access_text} {score} {t.countries_text}.</p>
                    </div>
                </div>
            );
        };

        const HealthCard = ({ water, vaccine, t }) => (
            <div className="bg-white border border-slate-100 rounded-xl p-5 mb-3 shadow-sm flex flex-row gap-4 items-start">
                <div className="p-3 rounded-xl shrink-0 border bg-teal-50 text-teal-600 border-teal-100"><Stethoscope size={20} /></div>
                <div className="flex-1">
                <h4 className="font-bold text-slate-800 text-lg mb-2">{t.health_title}</h4>
                <div className="space-y-2">
                    <div className={`flex items-center gap-2 text-sm font-medium ${water === 'safe' ? 'text-green-600' : 'text-red-500'}`}>
                    <Droplets size={16} />{water === 'safe' ? t.water_safe : t.water_unsafe}
                    </div>
                    {vaccine && <div className="flex items-center gap-2 text-sm font-medium text-amber-600"><AlertTriangle size={16} />{t.vaccine_mandatory} <span className="font-bold">{vaccine}</span></div>}
                </div>
                </div>
            </div>
        );

        const CustomsCard = ({ items, t }) => (
            <div className="bg-white border border-rose-100 rounded-xl p-5 mb-3 shadow-sm flex flex-row gap-4 items-start">
                <div className="p-3 rounded-xl shrink-0 border bg-rose-50 text-rose-600 border-rose-100"><Siren size={20} /></div>
                <div className="flex-1">
                <h4 className="font-bold text-slate-800 text-lg mb-2">{t.customs_title}</h4>
                <p className="text-xs font-bold uppercase text-rose-500 mb-2">{t.forbidden_items}</p>
                <ul className="list-disc list-inside text-sm text-slate-600 space-y-1">{items.map((item, idx) => <li key={idx}>{item}</li>)}</ul>
                </div>
            </div>
        );

        const ActionButton = ({ icon: Icon, title, subtitle, colorClass, link, isExternal }) => (
            <a href={link} target={isExternal ? "_blank" : "_self"} rel={isExternal ? "noopener noreferrer" : ""} className="flex items-center justify-between p-4 bg-white border border-slate-200 rounded-xl hover:border-blue-400 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group cursor-pointer">
                <div className="flex items-center gap-4">
                    <div className={`${colorClass} p-3 rounded-lg bg-opacity-10`}><Icon size={24} className={colorClass.replace('bg-', 'text-')} /></div>
                    <div className="text-left"><div className="font-bold text-slate-800">{title}</div><div className="text-xs text-slate-500">{subtitle}</div></div>
                </div>
                <ExternalLink size={16} className="text-slate-300 group-hover:text-blue-500 transition-colors" />
            </a>
        );

        const ServiceCard = ({ icon: Icon, title, desc, colorClass, link }) => (
            <a href={link} target="_blank" rel="noopener noreferrer" className="bg-white border border-slate-100 rounded-xl p-4 shadow-sm hover:shadow-md hover:border-blue-300 transition-all duration-300 flex items-center gap-4 group cursor-pointer">
                <div className={`p-3 rounded-xl shrink-0 ${colorClass} bg-opacity-10`}><Icon size={24} className={colorClass.replace('bg-', 'text-')} /></div>
                <div className="flex-1">
                    <div className="flex justify-between items-center"><h4 className="font-bold text-slate-800 group-hover:text-blue-600 transition-colors">{title}</h4><ExternalLink size={14} className="text-slate-300 group-hover:text-blue-500" /></div>
                    <p className="text-xs text-slate-500 mt-1">{desc}</p>
                </div>
            </a>
        );

        // --- NOUVELLES PAGES ---

        const BudgetEstimator = ({ t }) => {
            const [dest, setDest] = useState("");
            const [days, setDays] = useState(7);
            const [style, setStyle] = useState("med");
            const [result, setResult] = useState(null);

            const handleCalculate = () => {
                if(!dest) return;
                const country = countries.find(c => c.code === dest);
                const baseCost = 60; // Base mondiale moyenne en EUR
                const factor = country.costFactor || 1;
                
                let styleMult = 1;
                if (style === 'low') styleMult = 0.6;
                if (style === 'high') styleMult = 2.5;

                const total = Math.round(baseCost * factor * styleMult * days);
                setResult(total);
            };

            return (
                <div className="w-full max-w-lg mx-auto bg-white p-6 sm:p-8 rounded-3xl shadow-xl border border-slate-100 fade-in">
                    <div className="text-center mb-6">
                        <div className="mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-3">
                        <Calculator className="text-green-600" size={24} />
                        </div>
                        <h2 className="text-2xl font-bold text-slate-800">{t.budget_title}</h2>
                        <p className="text-slate-500 text-sm mt-1">{t.budget_desc}</p>
                    </div>

                    <div className="space-y-4">
                        <InputField label={t.label_destination} icon={MapPin}>
                        <CountrySelect value={dest} onChange={(e) => setDest(e.target.value)} placeholder={t.placeholder_select} />
                        </InputField>

                        <InputField label={t.duration_calc} icon={Clock}>
                        <input type="number" value={days} onChange={(e) => setDays(e.target.value)} className="w-full bg-slate-50 border border-slate-200 rounded-xl p-3" />
                        </InputField>

                        <div className="grid grid-cols-3 gap-2 mb-4">
                        <button onClick={() => setStyle('low')} className={`p-2 rounded-lg text-xs font-bold border ${style === 'low' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-slate-200 text-slate-500'}`}>{t.budget_style_low}</button>
                        <button onClick={() => setStyle('med')} className={`p-2 rounded-lg text-xs font-bold border ${style === 'med' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-slate-200 text-slate-500'}`}>{t.budget_style_med}</button>
                        <button onClick={() => setStyle('high')} className={`p-2 rounded-lg text-xs font-bold border ${style === 'high' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-slate-200 text-slate-500'}`}>{t.budget_style_high}</button>
                        </div>

                        <button onClick={handleCalculate} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition-all">
                        Calculer
                        </button>

                        {result && (
                        <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-xl text-center fade-in">
                            <span className="text-slate-500 text-sm block mb-1">{t.budget_result}</span>
                            <span className="text-3xl font-extrabold text-green-700">{result} €</span>
                        </div>
                        )}
                    </div>
                </div>
            );
        };

        const InsurancePage = ({ t }) => (
            <div className="w-full max-w-lg mx-auto bg-white p-6 sm:p-8 rounded-3xl shadow-xl border border-slate-100 text-center fade-in">
                <div className="mx-auto w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mb-4">
                <Umbrella className="text-rose-600" size={32} />
                </div>
                <h2 className="text-2xl font-bold text-slate-800 mb-2">{t.insurance_title}</h2>
                <h3 className="text-rose-600 font-bold uppercase tracking-wider text-xs mb-4">{t.insurance_subtitle}</h3>
                <p className="text-slate-600 mb-8 leading-relaxed">{t.insurance_desc}</p>
                
                <a 
                href={AFFILIATE_CONFIG.insurance_link}
                target="_blank"
                rel="noopener noreferrer"
                className="block w-full bg-rose-600 hover:bg-rose-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-rose-200 hover:shadow-rose-300 transition-all transform hover:-translate-y-1"
                >
                {t.btn_get_quote}
                </a>
                
                <div className="mt-8 flex justify-center gap-4 text-slate-400">
                <ShieldCheck size={24} />
                <Stethoscope size={24} />
                <Siren size={24} />
                </div>
            </div>
        );

        const FeedbackPage = ({ t }) => {
            const [sent, setSent] = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                setSent(true);
                setTimeout(() => setSent(false), 3000);
            };

            return (
                <div className="w-full max-w-lg mx-auto bg-white p-6 sm:p-8 rounded-3xl shadow-xl border border-slate-100 fade-in">
                <div className="text-center mb-6">
                    <div className="mx-auto w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mb-3">
                    <Mail className="text-indigo-600" size={24} />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800">{t.feedback_title}</h2>
                    <p className="text-slate-500 text-sm mt-1">{t.feedback_desc}</p>
                </div>

                {sent ? (
                    <div className="p-8 text-center text-green-600 font-bold bg-green-50 rounded-xl border border-green-100">
                    Message envoyé ! Merci.
                    </div>
                ) : (
                    <form onSubmit={handleSubmit} className="space-y-4">
                    <div>
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label>
                        <input type="email" required className="w-full bg-slate-50 border border-slate-200 rounded-xl p-3" placeholder="hello@example.com" />
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Message</label>
                        <textarea required rows="4" className="w-full bg-slate-50 border border-slate-200 rounded-xl p-3" placeholder={t.feedback_placeholder}></textarea>
                    </div>
                    <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition-all">
                        {t.btn_send}
                    </button>
                    </form>
                )}
                </div>
            );
        };

        // --- APPLICATION PRINCIPALE ---

        function App() {
            const [lang, setLang] = useState('FR');
            const [currentView, setView] = useState('home'); 
            const [step, setStep] = useState(0); 
            const [formData, setFormData] = useState({
                nationality: "FR",
                origin: "FR", 
                destination: "",
                age: 25,
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
            });
            const [result, setResult] = useState(null);

            // Auto-detection langue
            useEffect(() => {
                const userLang = navigator.language || navigator.userLanguage; 
                const code = userLang.split('-')[0].toUpperCase();
                if (['FR', 'EN'].includes(code)) setLang(code);
                else setLang('EN');
            }, []);

            const t = translations[lang] || translations.EN;

            const handleSearch = () => {
                if (!formData.destination) { alert(t.missing_dest_error); return; }
                if (formData.origin === formData.destination) { alert(t.origin_same_dest_error); return; }
                const start = new Date(formData.startDate);
                const end = new Date(formData.endDate);
                if (end <= start) { alert("La date de retour doit être après la date de départ."); return; }
                const diffTime = Math.abs(end - start);
                const durationDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                
                setStep(1);
                setTimeout(() => {
                    const passportInfo = countries.find(c => c.code === formData.nationality);
                    const originInfo = countries.find(c => c.code === formData.origin);
                    const destInfo = countries.find(c => c.code === formData.destination);
                    
                    let docs = [];
                    let isEuToEu = passportInfo.region === 'EU' && destInfo.region === 'EU';

                    if (isEuToEu) {
                        docs.push({ title: "Carte Nationale d'Identité (CNI)", status: "ok", description: "Suffisant pour les ressortissants UE.", mandatory: true, cost: "Gratuit" });
                    } else {
                        docs.push({ title: "Passeport Valide", status: "ok", description: "Doit être valide au moins 6 mois après le retour.", mandatory: true, cost: "Variable" });
                    }

                    // --- LOGIQUE VISAS EXEMPLES ---
                    if (destInfo.code === 'US') {
                        docs.push({ title: "ESTA USA", status: "alert", description: "Autorisation obligatoire à remplir au moins 72h avant.", mandatory: true, cost: "21 USD", link: "https://esta.cbp.dhs.gov/" });
                    } else if (destInfo.code === 'CA') {
                        docs.push({ title: "AVE Canada", status: "alert", description: "Autorisation de voyage électronique requise.", mandatory: true, cost: "7 CAD", link: "https://www.canada.ca/fr/immigration-refugies-citoyennete/services/visiter-canada/ave.html" });
                    }
                    
                    const flightLink = generateFlightLink(formData.origin, formData.destination, formData.startDate, formData.endDate);
                    // Génération du lien Booking avec les dates corrigées
                    const hotelLink = generateHotelLink(destInfo.name, formData.startDate, formData.endDate);

                    setResult({
                        passportPower: passportInfo.power,
                        destinationName: destInfo.name,
                        originName: originInfo.name,
                        documents: docs,
                        health: destInfo.health,
                        customs: destInfo.customs,
                        water: destInfo.water,
                        duration: durationDays,
                        flightLink: flightLink,
                        hotelLink: hotelLink
                    });
                    setStep(2);
                }, 1500);
            };

            const reset = () => { setStep(0); setResult(null); };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 flex flex-col">
                    <Header lang={lang} setLang={setLang} t={t} setView={setView} />
                    <DesktopNav t={t} currentView={currentView} setView={setView} />

                    <main className="flex-grow flex flex-col items-center justify-start pt-4 px-4 w-full max-w-5xl mx-auto pb-40">
                        
                        {/* HOME */}
                        {currentView === 'home' && (
                            <>
                                {step === 0 && (
                                    <div className="w-full max-w-lg fade-in">
                                        <div className="text-center mb-10">
                                            <h1 className="text-3xl sm:text-4xl font-extrabold text-slate-800 mb-3 tracking-tight">
                                                {t.hero_title} <span className="text-blue-600">{t.hero_highlight}</span>.
                                            </h1>
                                            <p className="text-slate-500 text-base sm:text-lg">{t.hero_desc}</p>
                                        </div>

                                        <div className="bg-white p-6 sm:p-8 rounded-3xl shadow-xl border border-slate-100 relative overflow-hidden">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <InputField label={t.label_nationality} icon={ShieldCheck}>
                                                    <CountrySelect value={formData.nationality} onChange={(e) => setFormData({...formData, nationality: e.target.value})} placeholder={t.placeholder_select} />
                                                </InputField>
                                                <InputField label={t.label_origin} icon={Navigation}>
                                                    <CountrySelect value={formData.origin} onChange={(e) => setFormData({...formData, origin: e.target.value})} placeholder={t.placeholder_select} />
                                                </InputField>
                                            </div>
                                            <InputField label={t.label_destination} icon={MapPin}>
                                                <CountrySelect value={formData.destination} onChange={(e) => setFormData({...formData, destination: e.target.value})} placeholder={t.placeholder_select} excludeCode={formData.origin} />
                                            </InputField>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                <InputField label={t.label_start_date} icon={Calendar}>
                                                    <input type="date" className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm" value={formData.startDate} onChange={(e) => setFormData({...formData, startDate: e.target.value})} />
                                                </InputField>
                                                <InputField label={t.label_end_date} icon={Calendar}>
                                                    <input type="date" className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm" value={formData.endDate} onChange={(e) => setFormData({...formData, endDate: e.target.value})} />
                                                </InputField>
                                            </div>
                                            <InputField label={t.label_age} icon={Trophy}>
                                                <input type="number" className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4" value={formData.age} onChange={(e) => setFormData({...formData, age: e.target.value})} />
                                            </InputField>
                                            <button onClick={handleSearch} className="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-3 group">
                                                {t.btn_analyze} <ArrowRight size={20} className="group-hover:translate-x-1 transition-transform" />
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {step === 1 && (
                                    <div className="flex flex-col items-center justify-center mt-20 fade-in">
                                        <div className="relative mb-8">
                                            <div className="absolute inset-0 bg-blue-100 rounded-full animate-ping opacity-75"></div>
                                            <div className="relative bg-white p-6 rounded-full shadow-xl border border-blue-50">
                                                <Plane size={48} className="text-blue-600 animate-pulse" />
                                            </div>
                                        </div>
                                        <h2 className="text-2xl font-bold text-slate-800">{t.loading_title}</h2>
                                        <p className="text-slate-400 mt-2 text-sm font-medium">{t.loading_text}</p>
                                    </div>
                                )}

                                {step === 2 && result && (
                                    <div className="w-full max-w-2xl fade-in">
                                        <div className="flex items-center justify-between mb-8">
                                            <button onClick={reset} className="text-slate-500 hover:text-slate-800 text-sm font-bold flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-white hover:shadow-sm transition-all">&larr; {t.result_back}</button>
                                            <div className="flex flex-col sm:flex-row sm:items-center gap-2 text-sm font-bold text-slate-800 bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-100">
                                                <div className="flex items-center gap-2"><span className="text-slate-400">{result.originName}</span><ArrowRight size={14} className="text-blue-500" /><span className="text-blue-600">{result.destinationName}</span></div>
                                                <span className="hidden sm:inline text-slate-300">|</span>
                                                <span className="text-slate-500 text-xs font-normal">{t.duration_calc} {result.duration} {t.days}</span>
                                            </div>
                                        </div>

                                        <PassportPower score={result.passportPower} t={t} />

                                        <div className="mb-10">
                                            <h3 className="text-xl font-bold text-slate-800 mb-5 flex items-center gap-3">
                                                {t.docs_title} 
                                                <span className="bg-slate-100 text-slate-600 text-xs font-bold px-2.5 py-1 rounded-full border border-slate-200">{result.documents.length}</span>
                                            </h3>
                                            <div className="space-y-4">
                                                {result.documents.map((doc, idx) => (
                                                <DocumentCard key={idx} {...doc} isMandatory={doc.mandatory} t={t} />
                                                ))}
                                                <HealthCard water={result.water || 'unsafe'} vaccine={result.health?.yellowFever ? 'Fièvre Jaune' : null} t={t} />
                                                {result.customs && result.customs.length > 0 && <CustomsCard items={result.customs} t={t} />}
                                            </div>
                                            <div className="mt-4 p-4 bg-blue-50/50 border border-blue-100 rounded-xl flex gap-3 text-sm text-blue-800">
                                                <div className="mt-0.5 shrink-0"><ShieldCheck size={18} /></div>
                                                <p className="font-medium">{t.docs_disclaimer}</p>
                                            </div>
                                        </div>

                                        <div className="mb-10">
                                            <h3 className="text-xl font-bold text-slate-800 mb-5">{t.services_title}</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <ServiceCard icon={Wifi} title={t.service_esim} desc={t.service_esim_desc} colorClass="bg-teal-500 text-teal-500" link={`https://www.airalo.com/?ref=${AFFILIATE_CONFIG.esim_id}`} />
                                                <ServiceCard icon={Ticket} title={t.service_activities} desc={t.service_activities_desc} colorClass="bg-purple-500 text-purple-500" link={`https://www.getyourguide.com/?partner_id=${AFFILIATE_CONFIG.activities_id}`} />
                                            </div>
                                        </div>

                                        <div className="mb-32">
                                            <h3 className="text-xl font-bold text-slate-800 mb-5 flex justify-between items-end">{t.action_title}</h3>
                                            <OfferCountdown t={t} />
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                                <ActionButton icon={Plane} title={t.action_flight} subtitle="" colorClass="bg-sky-500 text-sky-500" link={result.flightLink} isExternal={true} />
                                                <ActionButton icon={MapPin} title={t.action_hotel} subtitle="" colorClass="bg-indigo-500 text-indigo-500" link={result.hotelLink} isExternal={true} />
                                            </div>
                                            <div className="text-center p-8 rounded-3xl bg-gradient-to-br from-slate-900 to-slate-800 text-white shadow-xl relative overflow-hidden group">
                                                <div className="absolute top-0 right-0 p-8 opacity-10 transform rotate-12 group-hover:rotate-0 transition-transform duration-500"><Heart size={100} fill="currentColor" /></div>
                                                <Heart className="mx-auto text-rose-500 mb-4 fill-rose-500 animate-pulse" size={32} />
                                                <h4 className="text-xl font-bold mb-2">{t.donate_title}</h4>
                                                <p className="text-slate-300 mb-6 max-w-sm mx-auto text-sm leading-relaxed">{t.donate_text}</p>
                                                <button className="bg-white text-slate-900 px-8 py-3 rounded-full text-sm font-bold hover:bg-rose-50 hover:text-rose-600 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">{t.donate_btn}</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </>
                        )}

                        {/* OTHER VIEWS */}
                        {currentView === 'budget' && <BudgetEstimator t={t} />}
                        {currentView === 'insurance' && <InsurancePage t={t} />}
                        {currentView === 'feedback' && <FeedbackPage t={t} />}

                    </main>

                    <MobileNav t={t} currentView={currentView} setView={setView} />

                    <footer className="py-12 text-center border-t border-slate-100 bg-white/50 backdrop-blur-sm mt-auto mb-16 sm:mb-0">
                        <div className="flex flex-col items-center justify-center gap-2 text-slate-400 text-xs font-medium uppercase tracking-widest font-sans">
                            <div className="flex items-center gap-1"><Copyright size={12} /><span>2025 {t.app_name} Inc.</span></div>
                            <p>{t.footer_rights}</p>
                            <p className="opacity-60 text-[10px]">{t.footer_affiliate}</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // Rendu de l'application
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
